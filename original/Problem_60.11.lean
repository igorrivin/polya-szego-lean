/-
Polya-Szego Problem 60.11
Part One, Chapter 1

Original problem:
The number of inversions generated by a zig-zag path equals the area under the path. (Thus $\mathbf{6 0 . 1 0}$ determines the number of certain paths, or letter sequences, having a given number $\alpha$ of inversions.)

Let

$$
a_{0}, a_{1}, a_{2}, \ldots, a_{n}, \ldots
$$

be any complex numbers and

$$
p_{0}, p_{1}, p_{2}, \ldots, p_{n}, \ldots
$$

be non-negative real numbers. We define

$$
\begin{aligned}
& a_{0}+a_{1} z+a_{2} z^{2}+\cdots+a_{n} z^{n}+\cdots=A(z), \\
& p_{0}+p_{1} z+p_{2} z

Formalization notes: We formalize the majorant/minorant relationship for power series with complex coefficients.
   Given two formal power series A(z) = Σ a_n z^n and P(z) = Σ p_n z^n where:
     - a_n are complex numbers
     - p_n are nonnegative real numbers
     - |a_n| ≤ p_n for all n
   We say P is a majorant of A (or A is a minorant of P).
   
   We represent this as a predicate on sequences rather than as a relation on formal power series,
   since the problem only discusses coefficient-wise comparison.
   
   Note: The original problem uses notation A(z) ≪ P(z), but we use a predicate instead.
-/
-/

import Mathlib.Analysis.Complex.Basic
import Mathlib.Analysis.SpecialFunctions.Pow.Real
import Mathlib.Data.Real.Basic

/- Formalization notes:
   We formalize the majorant/minorant relationship for power series with complex coefficients.
   Given two formal power series A(z) = Σ a_n z^n and P(z) = Σ p_n z^n where:
     - a_n are complex numbers
     - p_n are nonnegative real numbers
     - |a_n| ≤ p_n for all n
   We say P is a majorant of A (or A is a minorant of P).
   
   We represent this as a predicate on sequences rather than as a relation on formal power series,
   since the problem only discusses coefficient-wise comparison.
   
   Note: The original problem uses notation A(z) ≪ P(z), but we use a predicate instead.
-/

/-- A power series A(z) = Σ a_n z^n is a minorant of P(z) = Σ p_n z^n if 
    for all n, |a_n| ≤ p_n and p_n ≥ 0. -/
def IsMinorant (a : ℕ → ℂ) (p : ℕ → ℝ) : Prop :=
  ∀ n, 0 ≤ p n ∧ Complex.abs (a n) ≤ p n

/-- Alternative formulation: P is a majorant of A. -/
def IsMajorant (p : ℕ → ℝ) (a : ℕ → ℂ) : Prop :=
  ∀ n, 0 ≤ p n ∧ Complex.abs (a n) ≤ p n

theorem problem_60_11_majorant_relation :
    ∀ (a : ℕ → ℂ) (p : ℕ → ℝ), IsMinorant a p ↔ IsMajorant p a := by
  intro a p
  exact ⟨fun h n => h n, fun h n => h n⟩

/- Additional theorems that capture more of the mathematical content: -/

/-- If P is a majorant of A, then the partial sums satisfy the same inequality. -/
theorem partial_sum_majorant (a : ℕ → ℂ) (p : ℕ → ℝ) (h : IsMinorant a p) (z : ℂ) (n : ℕ) :
    Complex.abs (∑ k in Finset.range (n + 1), a k * z ^ k) ≤ ∑ k in Finset.range (n + 1), p k * Complex.abs z ^ k := by
  refine le_trans (Complex.abs_sum_le _ _) ?_
  refine Finset.sum_le_sum fun k _ => ?_
  have hk := h k
  calc
    Complex.abs (a k * z ^ k) = Complex.abs (a k) * Complex.abs (z ^ k) := Complex.abs_mul _ _
    _ ≤ p k * Complex.abs (z ^ k) := by gcongr; exact hk.2
    _ = p k * Complex.abs z ^ k := by rw [Complex.abs_pow]

/-- For real z with |z| ≤ 1, the inequality extends to the full sums when they converge. -/
theorem majorant_convergence (a : ℕ → ℂ) (p : ℕ → ℝ) (h : IsMinorant a p) 
    (hz : Complex.abs z ≤ 1) (hp : Summable p) (ha : Summable fun n => a n * z ^ n) :
    Complex.abs (∑' n, a n * z ^ n) ≤ ∑' n, p n * Complex.abs z ^ n := by
  have hsum : Complex.abs (∑' n, a n * z ^ n) ≤ ∑' n, p n * Complex.abs z ^ n := by
    refine le_of_tendsto_of_tendsto' (ha.hasSum.norm.tendsto_sum_nat) 
      (tendsto_sum_nat_of_summable ?_) fun n => ?_
    · exact (hp.mul_left (Complex.abs z ^ 0)).of_nonneg_of_le (fun n => by positivity) 
        (fun n => by simp [mul_le_mul_right (by positivity), h n])
    · exact partial_sum_majorant a p h z n
  exact hsum

-- Proof attempt:
theorem problem_60_11_majorant_relation :
    ∀ (a : ℕ → ℂ) (p : ℕ → ℝ), IsMinorant a p ↔ IsMajorant p a := by
  intro a p
  exact ⟨fun h n => h n, fun h n => h n⟩