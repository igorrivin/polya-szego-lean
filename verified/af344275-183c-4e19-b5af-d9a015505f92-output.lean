/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: af344275-183c-4e19-b5af-d9a015505f92
-/

/-
We formalized and proved Polya-Szego Problem 145.
The theorem `problem_145` shows that if a series envelops a real number A and its terms strictly decrease in absolute value, then the terms alternate in sign and the envelopment is strict.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
If a series envelops a real number A and the terms strictly decrease in absolute value, then the terms alternate in sign and the envelopment is strict.
-/
theorem problem_145 {a : ℕ → ℝ} (A : ℝ)
    (h_envelop : ∀ n, let s_n := ∑ k ∈ Finset.range (2*n), a k;
                     let s_n1 := s_n + a (2*n);
                     s_n ≤ A ∧ A ≤ s_n1)
    (h_decreasing : ∀ n : ℕ, |a (n+1)| < |a n|)
    (h_a0_ne_zero : a 0 ≠ 0) :
    (∀ n, a n * a (n+1) < 0) ∧
    (∀ n, let s_n := ∑ k ∈ Finset.range (2*n), a k;
          let s_n1 := s_n + a (2*n);
          s_n < A ∧ A < s_n1) := by
  -- By definition of $s_n$ and $s_n1$, we know that $s_n < A < s_n1$ for all $n$.
  have h_strict_bounds : ∀ n, (∑ k ∈ Finset.range (2 * n), a k) < A ∧ A < (∑ k ∈ Finset.range (2 * n), a k) + (a (2 * n)) := by
    -- By definition of $s_n$ and $s_n1$, we know that $s_n \leq A \leq s_n1$ for all $n$.
    intro n
    have h_le : (∑ k ∈ Finset.range (2 * n), a k) ≤ A ∧ A ≤ (∑ k ∈ Finset.range (2 * n), a k) + (a (2 * n)) := by
      exact h_envelop n;
    refine' ⟨ lt_of_le_of_ne h_le.1 _, lt_of_le_of_ne h_le.2 _ ⟩ <;> contrapose! h_decreasing;
    · exact ⟨ 2 * n, by have := h_envelop ( n + 1 ) ; norm_num [ Nat.mul_succ, Finset.sum_range_succ ] at * ; cases abs_cases ( a ( 2 * n ) ) <;> cases abs_cases ( a ( 2 * n + 1 ) ) <;> linarith ⟩;
    · have := h_envelop ( n + 1 ) ; simp_all +decide [ Nat.mul_succ, Finset.sum_range_succ ];
      exact ⟨ 2 * n + 1, by cases abs_cases ( a ( 2 * n + 1 ) ) <;> cases abs_cases ( a ( 2 * n + 2 ) ) <;> linarith ⟩;
  refine' ⟨ fun n => _, h_strict_bounds ⟩;
  rcases Nat.even_or_odd' n with ⟨ k, rfl | rfl ⟩;
  · have := h_strict_bounds k; have := h_strict_bounds ( k + 1 ) ; simp_all +decide [ Nat.mul_succ, Finset.sum_range_succ ];
    cases abs_cases ( a ( 2 * k ) ) <;> cases abs_cases ( a ( 2 * k + 1 ) ) <;> nlinarith [ h_strict_bounds k ];
  · have := h_strict_bounds ( k + 1 );
    have := h_strict_bounds k; norm_num [ Nat.mul_succ, Finset.sum_range_succ ] at *; cases abs_cases ( a ( 2 * k + 1 ) ) <;> cases abs_cases ( a ( 2 * k + 2 ) ) <;> nlinarith [ h_decreasing ( 2 * k + 1 ), h_decreasing ( 2 * k + 2 ) ] ;