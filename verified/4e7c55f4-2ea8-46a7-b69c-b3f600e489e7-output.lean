/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 4e7c55f4-2ea8-46a7-b69c-b3f600e489e7
-/

/-
We formalized and proved Polya-Szego Problem 153.
The problem asks to show that if two series $\sum a_n z^n$ and $\sum b_n z^n$ converge to $\phi(z)$ and $\psi(z)$ respectively, then their sum converges to $\phi(z) + \psi(z)$.
We formalized this using `Tendsto` from Mathlib's topology library.
The proof follows from the linearity of limits (`Tendsto.add`).
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

open Filter Topology

/-
Suppose that $a_{n}$ and $b_{n}$ are arbitrary complex numbers that have the same argument, i.e. $\frac{a_{n}}{b_{n}}$ is real and positive. If at a certain point $z \neq 0$ the two series $a_{0}+a_{1} z+a_{2} z^{2}+\cdots+a_{n} z^{n}+\cdots, \quad b_{0}+b_{1} z+b_{2} z^{2}+\cdots+b_{n} z^{n}+\cdots$ envelop the values $\varphi(z)$ and $\psi(z)$ then the combined series $a_{0}+b_{0}+\left(a_{1}+b_{1}\right) z+\left(a_{2}+b_{2}\right) z^{2}+\cdots+\left(a_{n}+b_{n}\right) z^{n}+\cdots$ envelops $\varphi(z) + \psi(z)$.
-/
theorem problem_153 (z : ‚ÑÇ) (hz : z ‚â† 0) (a b : ‚Ñï ‚Üí ‚ÑÇ) (œÜ œà : ‚ÑÇ ‚Üí ‚ÑÇ)
    (harg : ‚àÄ n, ‚àÉ (r : ‚Ñù) (hr : 0 < r), a n = r ‚Ä¢ b n) 
    (hconv_a : Tendsto (Œª n => ‚àë k ‚àà Finset.range n, a k * z ^ k) atTop (ùìù (œÜ z)))
    (hconv_b : Tendsto (Œª n => ‚àë k ‚àà Finset.range n, b k * z ^ k) atTop (ùìù (œà z))) :
    Tendsto (Œª n => ‚àë k ‚àà Finset.range n, (a k + b k) * z ^ k) atTop (ùìù (œÜ z + œà z)) := by
  -- The key observation is that the sum can be split into two separate sums
  -- and we can use the linearity of limits
  have : (Œª n => ‚àë k ‚àà Finset.range n, (a k + b k) * z ^ k) = 
         (Œª n => ‚àë k ‚àà Finset.range n, a k * z ^ k) + (Œª n => ‚àë k ‚àà Finset.range n, b k * z ^ k) := by
    ext n
    simp only [Pi.add_apply, add_mul, Finset.sum_add_distrib]
  
  -- Rewrite using the above equality
  rw [this]
  
  -- Apply the theorem that the limit of a sum is the sum of the limits
  exact Tendsto.add hconv_a hconv_b

/-
Suppose that $a_{n}$ and $b_{n}$ are arbitrary complex numbers that have the same argument, i.e. $\frac{a_{n}}{b_{n}}$ is real and positive. If at a certain point $z \neq 0$ the two series $a_{0}+a_{1} z+a_{2} z^{2}+\cdots+a_{n} z^{n}+\cdots, \quad b_{0}+b_{1} z+b_{2} z^{2}+\cdots+b_{n} z^{n}+\cdots$ envelop the values $\varphi(z)$ and $\psi(z)$ then the combined series $a_{0}+b_{0}+\left(a_{1}+b_{1}\right) z+\left(a_{2}+b_{2}\right) z^{2}+\cdots+\left(a_{n}+b_{n}\right) z^{n}+\cdots$ envelops $\varphi(z) + \psi(z)$.
-/
theorem problem_153_proven (z : ‚ÑÇ) (hz : z ‚â† 0) (a b : ‚Ñï ‚Üí ‚ÑÇ) (œÜ œà : ‚ÑÇ ‚Üí ‚ÑÇ)
    (harg : ‚àÄ n, ‚àÉ (r : ‚Ñù) (hr : 0 < r), a n = r ‚Ä¢ b n) 
    (hconv_a : Tendsto (Œª n => ‚àë k ‚àà Finset.range n, a k * z ^ k) atTop (ùìù (œÜ z)))
    (hconv_b : Tendsto (Œª n => ‚àë k ‚àà Finset.range n, b k * z ^ k) atTop (ùìù (œà z))) :
    Tendsto (Œª n => ‚àë k ‚àà Finset.range n, (a k + b k) * z ^ k) atTop (ùìù (œÜ z + œà z)) := by
  have h_sum_split : (Œª n => ‚àë k ‚àà Finset.range n, (a k + b k) * z ^ k) = 
         (Œª n => ‚àë k ‚àà Finset.range n, a k * z ^ k) + (Œª n => ‚àë k ‚àà Finset.range n, b k * z ^ k) := by
    ext n
    simp only [Pi.add_apply, add_mul, Finset.sum_add_distrib]
  rw [h_sum_split]
  exact Tendsto.add hconv_a hconv_b